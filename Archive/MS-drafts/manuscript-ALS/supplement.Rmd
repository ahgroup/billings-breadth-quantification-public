---
title: "Supplemental Information for: Moving towards quantification of influenza vaccine protection accounting for heterologous virus antibody responses"
author: "Amanda L. Skarlupka, W. Zane Billings, Ted M. Ross, Andreas Handel"
date: "`r format(Sys.Date(), '%d %B %Y')`"
output:
  bookdown::word_document2:
    number_sections: false
  bookdown::pdf_document2:
    number_sections: false
  bookdown::html_document2:
    df_print: paged
always_allow_html: true
latex_engine: xelatex
bibliography: references.bib
---

```{r setup, include=FALSE}
  knitr::opts_chunk$set(
        echo = FALSE,
        message = FALSE,
        collapse=FALSE,
        warning = FALSE
    )

library(kableExtra)
library(flextable)
library(officer)
library(bookdown)
library(tidyverse)

set_flextable_defaults(fonts_ignore=TRUE)

```

# Implementation and Replicability

First download the original datafiles and file struture from the following repository: !!!(Insert Link). The data folder should contain all of the raw data necessary for analysis and cleaning. The data folder also contains the cluster data. The processed data folder will be populated with files. 

All files and analysis can be replicated by running the code folders in their appropriate order. The order is listed numerically. If files have the same value the can be ran in any order.  The exploratory code folder contains the initial exploratory analysis. The functions folder does not need to be ran. It contains R scripts that hold the functions that are sourced in the other documents. The calculations code folder contains the main analysis calculations for the antibody landscapes, and for the subsets. 

All of the resulting figures will be saved in the figures folder, and the tables saved to the tables folder. To recreate the manuscript, after running all of the code, the markdown files for the main text and the supplemental can be ran in the manuscript folder. 

The 2_cluster folder has the code for submitting the dimension selection analysis on UGA's GACRC computer cluster. This code only needs to be conducted if access is available to a large enough cluster. Otherwise all of the input and output data for the cluster is located in data/cluster. 

# Cohort Information:

From 2014 to 2016 volunteers were enrolled from Pittsburgh, PA, and Stuart, FL, USA. Individuals between the ages of 18 and 85 years of age. In 2016 until 2019, the study site was moved to Athens, GA, USA. In 2017, the ages of enrollment included individuals between 11 and 85 years of age. In 2018, adults 18-49 year of age were given the option for Flumist or Fluzone vaccination. This dataset includes only the individuals who opted for the Fluzone vaccination. Exclusion criteria for individuals included: receipt of influenza vaccine for the specific season, previous history of Guillain-BarrÃ©, dementia, Alzheimer disease, immunocompromised status, allergies to egg or egg products, concurrent enrollment in another influenza vaccine study, or less that two years of life expectancy.

The two main analyses look at either the standard dose (SD) only recipients (Table \@ref(tab:sd-demo)) or the elderly population who received either SD or high dose (HD) vaccinations (Table \@ref(tab:old-demo)).


```{r sd-demo, tab.cap="Cohort demographics for individuals of who received standard dose vaccination", tab.id='sd-demo', label='sd-demo'}

readRDS(file = here::here(
	"results", "tables", "cohort_demographics_standard_dose.rds")
) |>
	rownames_to_column(var = "Season") |>
	flextable() 

```


```{r old-demo, tab.cap="Cohort demographics for individuals of equal to or greater than 65 years of age stratified by dose and season", tab.id='old-demo', label='old-demo'}

readRDS(file = here::here("results", "tables", "cohort_demographics_elderly.rds")) |>
  rownames_to_column(var = "Dose") |>
  flextable() |>
  set_header_labels(values = list(`2014_SD` = "SD",
                                 `2015_SD` = "SD",
                                 `2016_SD` = "SD",
                                 `2017_SD` = "SD",
                                 `2018_SD` = "SD",
                                 `2019_SD` = "SD",
                                 `2014_HD` = "HD",
                                 `2015_HD` = "HD",
                                 `2016_HD` = "HD",
                                 `2017_HD` = "HD",
                                 `2018_HD` = "HD",
                                 `2019_HD` = "HD")) |>
  add_header_row(top = TRUE,
                 values = c("Season", "2014", "2015", "2016", "2017", "2018", "2019"),
                 colwidth = c(1, rep(2, 6)))

```


# Viruses:

The recommended influenza vaccine compositions changed over the seasons dependent on the circulating strains at the time (see main manuscript). A broad selection of H1N1 and H3N2 viruses were included in the HAI panel (Table \@ref(tab:viruses)).

```{r viruses, tab.cap="Strain names and source of HA amino acid sequence used for analysis", tab.id='viruses', label='viruses'}

readRDS(here::here("results/tables/virus_accession.rds"))  |>
  dplyr::filter(short_name %in% readRDS(here::here("data/processed/viruses_used.rds"))$strain_short) |>
  dplyr::select(-c(`2014`:`2019`)) |>
  flextable() |>
  set_header_labels(values = list(full_strain_name = "Strain Name",
                                 analysis_name = "Short Name",
                                 short_name = "Abbreviation",
                                 full_length = "Full Length?",
                                 ha_source = "HA Sequence Source")) |>
  add_footer(top = FALSE, season = "If the full length sequence was not available the numbering of the residues that are available are listed") |>
    #add_header_row(top = TRUE,
    #             values = c(" ", "Season Used in HAI panel"),
    #             colwidths = c(5, 6)) |>
    merge_at(j = 1:5, part = "footer") |>
 # align(j = 6:11, align = "center") |>
    autofit()
```

# Sequence based Measure:

## Residue numbers for antigenic site determination:

The HA amino acid sequences were either extracted from the UniProt protein database using the Rcpi package getSeqFromUniProt() function and the UniProt accession numbers, or from manually downloading the sequence from the Gisaid database if the sequence was not available on UniProt [@Rcpi; @elbe2017; @uniprot2020].

The antigenic sites used for calculating the sequence-based P-epitope were previously defined [@munoz2005; @deem2009]. The specific residues used are included in Table \@ref(tab:sites). The numbering begins at the beginning of the N-terminal sequence of the mature protein after the signal peptide had been removed [@burke2014]. The extraction of the defined antigenic sites were done in R using the 'seqinr' and 'Biostrings' packages [@seqinr; @Biostrings].

```{r sites, tab.cap="Amino acid residues used for the sequence-based distance measure, P-epitope.", tab.id='sites', label='sites'}
readRDS(file = here::here("results/tables/antigenic_sites.rds")) |>
   flextable() |>
  flextable::width(j = 3, width = 5) |>
  hline(5) |>
  merge_v(j = 1) |>
  add_footer(top = FALSE, Subtype = "H1N1 numbering follows A/California/04/2009 numbering scheme.\nAll numbering starts at the beginning of the N-terminal sequence of the mature protein after removal of the signal peptide. ") |>
    merge_at(j = 1:3, part = "footer")

```

# Antigenic Cartography of Human Sera:

For vaccine strain selection, influenza-naive ferrets are used for anti-sera generation. These animals have no pre-existing immunity to influenza. This model provides a platform that is free of imprinting bias that is afforded by an initial to exposure to influenza. Humans, however, have been imprinted during childhood with the first strain that infected them. Imprinting bias has been observed between subtypes; H1N1 imprinted individuals do not have the same immune response to an H3N2 of H7NX infection as an H3N2 imprinted individual would. Therefore, using an influenza-naive ferret model for immunological responses may not be as appropriate as a model with an influenza preimmune background.

Most humans older than four years have been immunologically exposed to influenza virus either through an initial vaccination or an infection. Individuals born before 1956 were imprinted with H1N1, individuals from 1956 to 1968 with H2N2 and individuals from 1968 to 1977 with H3N2. However, after 1977 individuals could have been initially imprinted with either H1N1 or H3N2 due to the re-emergence of the H1N1 viruses. If imprinted after 2009 with an H1N1, individuals were exposed to an antigenically shifted virus compared to the prior to 2009 when the human seasonal H1N1 virus was circulating.

## Dataset and number of dimensions selection:

Antigenic cartography pairwise distances between viruses were calculated using the HAI titers from the cohort. The antigenic cartography calculations were conducted with the R package, Racmacs [@Racmacs]. HAI titers were separated by viral subtype (H1N1, H3N2) and by sera collection timing (pre- and post-vaccination). The titers were also analyzed by looking at only the individuals who received the SD vaccination to determine if the dose affects the pairwise distances of the viruses.

Initially, the appropriate number of dimensions for analysis was determined (Racmacs::dimensionTestMap()). Each map was cross-validated to determine how well the predicted titers match the observed titers. When comparing maps created with all of the sera-virus pairs and only the standard dose sera-virus pairs there was minimal difference between the root mean square error (RMSE) of the maps (Table \@ref(tab:dimensions)). The RMSE was calculated separately for the detectable titers and the nondetectable titers (titers below the limit of detection \<1:10). When comparing the different dimensions the detectable RMSE of the H1N1 viruses plateaued at two dimensions (Figure \@ref(fig:detect)). For the H3N2 viruses the RMSE plateaued at three dimensions, with the decrease from two to three dimensions being minimal compared to the decline from one to two dimensions (Table \@ref(tab:dimensions)).

```{r dimensions, tab.cap="Dimensional analysis of H1N1 and H3N2 human cartography maps pre- and post-vaccination using all sera available (all) or only sera from SD individuals (SD).", tab.id='dimensions', label='dimensions'}
readRDS(here::here("results", "tables", "TwoDimensionalValidation.rds")) |>
  select(-type) |>
  select(subtype, timing, dimensions, vaccine, mean_rmse_detectable, var_rmse_detectable, mean_rmse_nondetectable, var_rmse_nondetectable) |>
  mutate(dimensions = as.character(dimensions)) |>
    arrange(subtype, timing, dimensions) |>
  flextable() |>
  set_header_labels(values = list(subtype = "Subtype",
                                 timing = "Timing",
                                 vaccine = "Vaccine",
                                 dimensions = "Dimensions",
                                 mean_rmse_detectable = "Mean RMSE",
                                 var_rmse_detectable = "Var RMSE",
                                 mean_rmse_nondetectable = "Mean RMSE",
                                 var_rmse_nondetectable = "Var RMSE")) |>
    colformat_double(digits = 3) |>
  add_header_row(top = TRUE,
                 values = c(" ", "Detectable", "Nondetectable"),
                 colwidths = c(4, 2, 2)) |>
  merge_v(j = c("subtype", "timing", "dimensions")) |>
      hline(i = seq(from = 2, to = 40, by = 2)) |>
    add_footer(top = FALSE, subtype = "Each dimension was tested with 100 replicates, with each of those maps undergoing 1000 optimizations. The test proportion was 10% of the full data set.") |>
    merge_at(j = 1:8, part = "footer") |>
    autofit() |>
    fit_to_width(max_width = 6.5)
```



```{r detect, fig.cap="Validation of two dimensional antigenic cartography with human sera. Each of the datasets were tested through five dimensions. Two dimensions was determined to be appropriate for visualizing the maps as indicated by the leveling off of the root mean square prediction error (RMSE). Each dimension was tested with 100 replicates, with each of those maps undergoing 1000 optimizations. The test proportion was 10% of the full data set"}

knitr::include_graphics(here::here("results", "figures", "TwoDimensionalValidation.png"))

```

## Comparison to previous studies

Antigenic cartography was introduced with the H3N2 viruses using ferret sera [@smith2004a]. From there @fonville2015 expanded the initial map which previously ended at 2002 to 2014. The viruses in our most recent dataset do not overlap entirely with the viruses used for these maps. Further, the antigenic maps for the H1N1 viruses have been done using serological HAI data for H1 swine viruses [@lorusso2010; @tapia2020] and using sequence-based antigenic distance estimates [@anderson2018]. Therefore, before using the distances from the cartographies from this study, we wished to confirm that the H3N2 antigenic cartographies created with adult human sera matched the previous H3N2 cartographies created with ferret sera [@smith2004a; @fonville2015] and with child human sera. Child human sera was used for the @fonville2015 study to minimize the pre-existing antibodies to influenza in the sera. Adolescents and adults have a history of exposure, therfore we wished to confirm that these pre-existing antibodies did not overtly affect the position of the viral antigens on the cartographies.

The @smith2004a HAI data was sourced from the Racmacs R package [@Racmacs]. The @fonville2015 HAI data was sourced from the manuscript's supplementary data, specifically supplementary dataset 5 for the ferret H3N2 maps and supplementary dataset 4 for the high responding human H3N2 maps. The map from this study used as the comparator was the H3N2 map created with the post-vaccination standard dose only sera. All maps were compared to each other using procrustes analysis allowing for translation, scaling, or both (Table \@ref(tab:proc)). Scaling when aligning maps was recommended for combination of data created using different assays. When comparing the @smith2004a maps to the current study maps, the root means square distance (RMSD) of the antigens was smaller when scaling and translation were both applied to the pre-immune human cartography.

```{r proc, tab.cap = "Procrustes analysis RMSD values under different alignment conditions", tab.id='proc', label='proc'}

as.data.frame(readRDS(here::here("results", "tables", "rmsd_procrustes.rds"))) |>
  flextable() |>
    colformat_double(digits = 2) |>
  merge_v(j = "Map 1") |>
      hline(i = c(3, 5,6)) |>
    set_header_labels(values = list(`Translation = T` = "Translation = T\nScaling = F",
                                 `Scaling = T` = "Translation = F\nScaling = T",
                                 `Both = T` = "Translation = T\nScaling = T")) |>
    add_footer(top = FALSE, `Map 1` = "Map 1: Map that is procrustes against\nMap 2: Comparison map\nRMSD: root mean square distance") |>
    merge_at(j = 1:6, part = "footer") |>
    add_header_row(top = TRUE,
                 values = c(" ", "RMSD of the Antigen Point Differences"),
                 colwidths = c(3, 3)) |>
  flextable::width(j = 4:6, width = 1.25)
```

The antigenic cartographies of @fonville2014 and this study (Skarlupka) were compared through procrustes analysis with the @smith2004a cartography (Figure \@ref(fig:procrustes)).

```{r procrustes, fig.cap = "Procrustes analysis of the Fonville and Skarlupka datasets to the Smith viruses. Only the virus antigens are shown. For the procrustes analysis only translation was allow with no scaling. Red open circles are viruses present only in the Smith dataset. Black circles are shared viruses between datasets. Arrows indicate where the virus is mapped to for either the Fonville or Skarlupka datasets."}
knitr::include_graphics(here::here("results", "figures", "smith_procrustes.png"))

```

Due to our interest in the antigenic distance from a specified vaccine strain, we analyzed specifically the relative antigenic distance introduced previously [@wang2021]. The relative antigenic distances first determining the virus of interest. Then the distance from the virus of interest to another virus was calculated by extracting the position coordinates of both viruses and calculating the Euclidean distance between the two points. The relative antigenic distances between viruses were calculated for each map and for each virus. The correlation of the @smith2004a distances to the other maps for each reference virus was determined (Figure \@ref(fig:relative); Table \@ref(tab:corr)). The relative distances with the pre-vaccination and all sera dataset maps were compared and did not differ significantly from the results of the post-vaccination standard dose sera dataset.

```{r relative, fig.cap = "Correlations of the relative euclidean distances from A/H3N2/Panama/2007/1999. The relative distances to PM/99 from the Smith, 2004 dataset were compared with the matching antigens in the ferret and human datasets from Fonville, 2015 and in this current study (standard dose dataset). All maps were aligned to the Smith, 2004 maps allowing for only translation. The matched viruses between the Smith, 2004 dataset and the other datasets are labeled on the respective plots. The linear regression between the paired points are shown with 95% confidence intervals with the blue line. The black line indicates the line of identity (y = x).", echo=FALSE}

knitr::include_graphics(here::here("results", "figures", "distance_corr.png"))
```


```{r corr, tab.cap = "Pearson's correlation coefficients for all relative distances compared to the Smith, 2004 dataset.", tab.id='corr', label='corr'}

readRDS(here::here("results", "tables", "rsqr.rds")) |>
  mutate(across(.cols = starts_with("p_value"),
                ~ ifelse(.x < 0.001, "<0.001", round(.,
                                                     digits = 3)))) |>
  flextable() |>
    colformat_double(digits = 3) |>
    set_header_labels(values = list(relative_virus = "Relative Virus",
                                 r_squared_fonville_ferret = "r",
                                 p_value_fonville_ferret = "p-value",
                                 r_squared_fonville_human = "r",
                                 p_value_fonville_human = "p-value",
                                 r_squared_current = "r",
                                 p_value_current = "p-value")) |>
    add_footer(top = FALSE, relative_virus = "Pearson's correlation coefficient (r) and two-sided p-value") |>
    merge_at(j = 1:7, part = "footer") |>
    add_header_row(top = TRUE,
                 values = c(" ", "Fonville Ferret", "Fonville Human", "Skarlupka"),
                 colwidths = c(1, rep(2, 3))) |>
    autofit() |>
    align(align = "center", part = "all")
```

Of the different virus pairs there was only one that was not significantly correlated with the @smith2004a distances, SI/2/87 (Sing/87) with a pearson correlation coefficient of 0.555. The @fonville2015 dataset did not contain this virus to provide a comparison.

The datasets were then separated even further into individual seasons to determine if there was a season-based effect. However, after stratifying by season the high correlation between the pre- and post-vaccination relative distances still remained for the H3N2 viruses (Figure \@ref(fig:seasonh3)) and the H1N1 viruses (Figure \@ref(fig:seasonh1)). The total number of viral antigens and sera samples used for each map is included in Table \@ref(tab:sizes).

```{r seasonh3, fig.cap = "Relative distances to the vaccine strains for each season for pre- and post-vaccination standard dose sera datasets of the H3N2 viruses. The vaccine strains for the given season was used as the relative virus for calculating the distances. Plots were faceted by season with the sample size of individuals used for creation of each map. The number of individuals varied due to some being undercontrained for map placement. The Pearsons correlation coefficent (R) and the two-sided p-value are shown. The blue line indicates the linear regression with 95% confidence intervals, and the black line is the line of identity (y = x)."}
knitr::include_graphics(here::here("results", "figures", "h3_prepost_mapDistance.png"))

```


```{r seasonh1, fig.cap="Relative distances to the vaccine strains for each season for pre- and post-vaccination standard dose sera datasets of the H1N1 viruses. The vaccine strains for the given season was used as the relative virus for calculating the distances. Plots were faceted by season with the sample size of individuals used for creation of each map. The number of individuals varied due to some being undercontrained for map placement. The Pearsons correlation coefficent (R) and the two-sided p-value are shown. The blue line indicates the linear regression with 95% confidence intervals, and the black line is the line of identity (y = x)."}
knitr::include_graphics(here::here("results", "figures", "h1_prepost_mapDistance.png"))

```


```{r sizes, tab.cap = "Number of viruses and sera samples included in each antigenic cartography.", tab.id='sizes', label='sizes'}
readRDS(file = here::here("results", "tables", "SeasonBasedSampleSize.rds")) |>
flextable() |>
    set_header_labels(values = list(season = "Season",
                                 subtype = "Subtype",
                                 virus_count_cart_2d_pre = "Pre",
                                 virus_count_cart_2d_post = "Post",
                                 sera_count_cart_2d_pre = "Pre",
                                 sera_count_cart_2d_post = "Post")) |>
    add_header_row(top = TRUE,
                 values = c(" ", "Virus Counts", "Sera Counts"),
                 colwidths = rep(2, 3)) |>
    merge_v(j = "season") |>
    hline(i = seq(2, 12, by = 2)) |>
    autofit() |>
    fit_to_width(max_width = 6.5) |>
	flextable::fix_border_issues()

```

From this analysis the post-vaccination standard dose antigenic cartography maps were used to calculate each virus' relative distance from a vaccine strain for both the H1N1 and H3N2 subtypes.

Antigenic distances between the H1N1 strains were determined using antigenic cartography created use human post-vaccination HAI titers to a panel of H1N1 viruses and H3N2 viruses (Figure \@ref(fig:postsd-map)).

```{r postsd-map, fig.cap = "Antigenic cartography created from with sera after Fluzone vaccination (standard dose). H1N1 (A) and H3N2 (B) viral antigenic maps. All seasons were included. Individuals and antigens that did not have more than three measured HAI titers were removed from the metric-multidimensional scaling because they were underconstrained for map placement. The stress indicates the residual sum of squares between the estimated map distances and the known titer distances. 1 Antigenic Distance Unit = 1 $log_2$ fold change in HAI titer", echo = FALSE }
knitr::include_graphics(here::here("results", "figures", "sd_post_maps.png"))
```

# Normalization of Measures:

The pair-wise distances had different ranges depending on the measure used. Therefore, to allow for comparison between them they were normalized. Three different normalization schemes were investigated due to the variation in the HAI panel used over the different seasons. 

Season-based Normalization:

$$ \text{Normalized Distance}_{ijklm} = \frac{d_{ijklm}}{Max(D_{ijkl})}$$

Strain-based Normalization:

$$ \text{Normalized Distance}_{ijklm} = \frac{d_{ijklm}}{Max(D_{ijk})} $$

Vaccine-based Normalization:

$$ \text{Normalized Distance}_{ijklm} = \frac{d_{ijklm}}{Max(D_{il})} $$
where:

$$\begin{align}
d &= \text{Untransformed Pair-wise Distance}\\
i &= \text{Distance Method (Year, P-epitope, Cartography)} \\
j &= \text{Vaccine Subtype (H1N1, H3N2)} \\
k &= \text{Vaccine Strain} \\
l &= \text{Influenza Season (2014-2019)} \\
m &= \text{HAI panel strain}
\end{align} $$ 

The maximum distances used changes depending upon the grouping (Table \@ref(tab:max)) The season- and vaccine-based normalizations are the most similar in maximum values. For the H1N1 viruses the HAI panel did not vary much for the CA/09 and MI/15 vaccine viruses since the panel did not change significantly over those seasons. For the H3N2 viruses the normalization denominator was similar up until 2018 and 2019 when the panel was truncated. The difference in virus panels over time are more clearly depicted in Figures \@ref(fig:ranking-h1) and \@ref(fig:ranking-h3).

```{r max, tab.cap = "Maximum normalized distances when grouping by season, vaccine, or subtype", tab.id='max', label='max', eval = FALSE}

sub <- fp_text(vertical.align = "subscript", font.size = 12)

ft <- readRDS(here::here('results", "tables", "max_distance_values.rds')) |>
flextable() |>
    set_header_labels(values = list(method = "Method",
                                 strain_type = "Subtype",
                                 vac_short = "Vaccine",
                                 season = "Season",
                                 by_strain = "by_strain",
                                 by_vaccine = "by_vaccine",
                                 by_season = "by_season")) |>
    add_header_row(top = TRUE,
                 values = c(" ", "Strain", "Season", "Vaccine"),
                 colwidths = c(4, rep(1, 3))) |>
    merge_v(j = c("method", "strain_type", "vac_short", "by_strain", "by_vaccine", "by_season")) |>
      hline(i = 1:36)

ft <- flextable::compose(ft, i = 2, j = "by_strain", part = "header", 
                    value = as_paragraph("Max(D", as_chunk("ijk", props = sub), ")"))
ft <- flextable::compose(ft, i = 2, j = "by_vaccine", part = "header", 
                    value = as_paragraph("Max(D", as_chunk("il", props = sub), ")"))
ft <- flextable::compose(ft, i = 2, j = "by_season", part = "header", 
                    value = as_paragraph("Max(D", as_chunk("ijkl", props = sub), ")"))
ft <- autofit(ft) |>
    fit_to_width(max_width = 6.5)

ft
```

# Comparison of Measures:

One of the key features of using different distance measures to quantify pair-wise viral distances is that the relative ordering of the virus panel is adjusted depending on which measure is used. For example Bris/07 has a very short year distance from CA/09 (2 years) but a larger sequence- and antigenic-based distance (Figure \@ref(fig:individual)). Whereas for the H3N2, the rankings between the viruses do not change as often as the H1N1 strains due to the linear relationship between the year, sequence, and cartography (Figure \@ref(fig:individual)).

# Pre- and Post-vaccination Titer Analysis

An individual's pre- and post-vaccination titers are shown to clearly depict the antibody landscapes that are obtainable from the dataset (Figure \@ref(fig:individual)). With the changes in measure, the area under the HAI titers lines change as well. 

```{r individual, echo=FALSE, fig.cap= "Pre- and post- vaccination titers to the H1 and H3 viruses for one individual in the 2014 season. The relative distances of viruses in the panel are shown in text below the respective titers. Comparing the methods across the H1N1 viruses, the relative positioning of the panel viruses was reordered. For the H3N2 viruses the reordering was not as drastic but still present as well. The values represent the HAI results of one individual who received a standard dose vaccination in the 2014 season. The virus strain at each distance is shown in text.", fig.width=6}
knitr::include_graphics(here::here("results", "figures", "typeA_sd_individual.png"))
```


Next the entire dataset was analyzed using the by season normalization measure for the pre- and post-vaccination titer outcome (Figure \@ref(fig:pre-season)). The CA/09 and HK/14 strain analyzes were shown in the main manuscript. Further, the other strain specific responses are shown in Figure \@ref(fig:pre-strain).

```{r pre-season, fig.cap="Pre- and post- vaccination titers to the H1N1 and H3N2 virus panels by season of all individuals who received standard dose vaccination (sample size per season included in each plot). The vaccination strain of each subtype per season is shown in the row label. The linear regression of the pre and post vaccination titers with 95% confidence intervals are shown. The three distance measures are shown in the column label. The measures were normalized by the maximum value by method, subtype, vaccine strain and season. The resulting linear regression equations of the pre- and post-vaccination linear regressions are included."}
knitr::include_graphics(here::here("results", "figures", "typeA_sd_prepost_season.png"))
```



```{r pre-strain, fig.cap="Pre- and post- vaccination titers to the H1N1 and H3N2 virus panels by season of all individuals who received standard dose vaccination (sample size per season included in each plot). The vaccination strain of each subtype per season is shown in the row label. The linear regression of the pre and post vaccination titers with 95% confidence intervals are shown. The three distance measures are shown in the column label. The measures were normalized by the maximum value by method, subtype, vaccine strain and season. The resulting linear regression equations of the pre- and post-vaccination linear regressions are included."}
knitr::include_graphics(here::here("results", "figures", "typeA_sd_prepost_strain.png"))
```

# Titer Increase Analysis

## Strain Level

Next the entire dataset was analyzed using the season- and vaccine-level normalization measures for the titer increase outcome (Figure \@ref(fig:titinc-season) and \@ref(fig:titinc-vaccine)). 

```{r titinc-ind, fig.cap = "The individal titer increase if the virus was a categorical variable.", eval = FALSE}
knitr::include_graphics(here::here("results", "figures", "sd_strain_individual.png"))
```


```{r wo-distance-sd}
 readRDS(file = here::here("data/processed/averaged_SD_pro.rds")) |>
   select(c(strain_type, vac_short, mean_tit, ind_n, total_strain, total_test, response, no_response, pro)) |>
   flextable::flextable() |>
   set_header_labels(values = list(strain_type = "Subtype",
                                  vac_short = "Strain",
                                 mean_tit = "Mean log_2 TI",
                                 ind_n = "Individuals",
                                 total_strain = "Viruses in HAI Panel",
                                 response = ">= 2 log2 TI",
                                 no_response = "< 2 log2 TI",
                                 total_test = "Experiments Conducted",
                                 pro = "Proportion w/Positive Response")) |>
    merge_v(j = "strain_type") |>
      flextable::hline(3) |>
  flextable::vline(j = c(2, 3, 6, 8)) |>
	flextable::fix_border_issues() |>
      add_header_row(top = TRUE,
                 values = c(" ","Sample Size (n=)", "HAI TI Outcome", " "),
                 colwidths = c(3, 3, 2, 1))
```

```{r titinc-strain, fig.cap="The titer increase to the H1N1 and H3N2 virus panels for all individuals who received standard dose vaccination by vaccine strain. The rows are separated by vaccine strain for the H1N1 (A) and H3N2 (B) subtypes. The linear regression of the titer increase with 95% confidence intervals are shown for each distance method. The measures were normalized by the maximum value by method and vaccine strain. The raw datapoints had jitter applied with +/- 0.4 in the y-axis. Raw data points that fell outside of the y-axis bounds are not shown. Dashed line = titer increase of zero." }
knitr::include_graphics(here::here("results", "figures", "typeA_sd_titerincrease_strain.png"))
```


## Season Level 

```{r titinc-season, fig.cap="The titer increase to the seasonal H1N1 and H3N2 virus panels for all individuals who received standard dose vaccination. The linear regression of the titer increase with 95% confidence intervals are shown for each distance method. The measures were normalized by the maximum value by method, season, and vaccine strain. The raw datapoints had jitter applied with +/- 0.4 in the y-axis. Raw data points that fell outside of the y-axis bounds are not shown. Dashed line = titer increase of zero." }
knitr::include_graphics(here::here("results", "figures", "typeA_sd_titerincrease_season.png"))
```

## Vaccine Level

The Fluzone influenza vaccine administered to the cohort was a multivalent formulation that contained H3N2, H1N1, and Type B influenza inactivated viruses. The previous analyses investigated the subtype level effects. However the breadth of the vaccine response can include the different subtypes as well (Figure @ref(fig:titinc-vaccine)).

```{r titinc-vaccine, fig.cap="The titer increase to the H1N1 and H3N2 virus panels for all individuals who received standard dose vaccination. The columns are separated by vaccine strain. The linear regression of the titer increase with 95% standard error bands are shown for each distance method. If the standard error bands are not visible then they are smaller than the width of the line. The measures were normalized by the maximum value by method and season. The raw datapoints had jitter applied with +/- 0.4 in the y-axis. Raw data points that fell outside of the y-axis bounds are not shown." }
knitr::include_graphics(here::here("results", "figures", "typeA_sd_titerincrease_vaccine.png"))
```



# Quantification

A value of 2 antigenic units (AU) was used as the cutoff for the antigenic weighting scheme. However, since the distances were normalized to a range of 0-1, a distance of 2 AU needed to be transformed into the normalized distance. The normalized distances used as the cutoff for 2 AU are outlined in Table \@ref(tab:twoAU).

```{r twoAU, tab.cap = "Normalized Distances that equate to 2 antigenic units.", tab.id='twoAU', label='twoAU'}

readRDS(file = here::here("results", "tables", "AU_cutoff.rds")) |>
  mutate(season = as.character(season)) |>
flextable() |>
  colformat_double(digits = 3) |>
    set_header_labels(values = list(season = "Season",
                                 vac_short = "Vaccine",
                                 cutoff = "2 AU in Normalized Distance")) |>
    merge_v(j = "season") |>
  merge_v(j = "distance_type") |>
      hline(i = c(seq(2, 12, by = 2))) |>
    autofit() |>
    fit_to_width(max_width = 6.5)
```

## Standard Dose Analysis

The area under the linear regression for the different seasons for the standard dose individuals was quantified (Table \@ref(tab:auc-season)). 

```{r auc-season, tab.cap = "Area under the linear regression for three weighting schemes for the different seasons.", tab.id='auc-season', label='auc-season'}
readRDS(file = here::here("results", "tables", "auc_sd_season.rds")) |>
  mutate(season = as.character(season)) |>
  select(-strain_type) |>
flextable() |>
    set_header_labels(values = list(season = "Season",
                                 vac_short = "Vaccine",
                                 method = "Method",
                                 auc_pred = "Unweighted",
                                 auc_linear = "Linear",
                                 auc_anti = "2 AU")) |>
    merge_v(j = c("season", "vac_short")) |>
      hline(i = seq(3, 36, by = 3)) |>
    autofit() |>
    fit_to_width(max_width = 6.5)
```


```{r auc-strain, tab.cap = "Area under the curve (AUC) for vaccine strains with different weighting schemes applied.", tab.id='auc-strain', label='auc-strain', eval = FALSE}
readRDS(file = here::here("results", "tables", "auc_sd_strain.rds")) |>
  dplyr::mutate(vac_short = factor(vac_short, labels = substr(levels(vac_short), #Remove the H1N1/H3N2 in front
                                                              start = 6,
                                                              stop = nchar(levels(vac_short))))) |>
select(strain_type, vac_short, method, auc_pred, auc_linear, auc_anti) |>
flextable() |>
  set_header_labels(values = list(strain_type = "Subtype",
                                  vac_short = "Vaccine",
                                 method = "Method",
                                 auc_pred = "Unweighted",
                                 auc_linear = "Linear",
                                 auc_anti = "2 AU")) |>
    colformat_double(digits = 3) |>
  add_header_row(top = TRUE,
                 values = c(" ", "AUC"),
                 colwidths = c(3, 3)) |>
  align(align = "center", part = "all")|> 
  merge_v(j = c("strain_type", "vac_short")) |>
      hline(i = 3) |>
      autofit() |>
    fit_to_width(max_width = 6.5) |>
    hline(i = seq(3, nrow(readRDS(file = here::here("tables/manuscript/auc_sd_strain.rds"))), by = 3))

```

This may be a replicate of Table \@ref(tab:auc-vaccine).
```{r, echo = FALSE, include=FALSE}

readRDS(file = here::here("results", "tables", "auc_sd_vaccine.rds")) |>
  dplyr::select(-vac_short) |>
  tidyr::pivot_longer(cols = auc_pred:auc_linear,
               names_to = "weighting",
               values_to = "auc") |>
  tidyr::pivot_wider(names_from = strain_type,
               values_from = auc) |>
  dplyr::rowwise() |>
  dplyr::mutate(overall = H1N1 + H3N2,
         season = factor(season)) |>
  dplyr::select(-c(H1N1, H3N2)) |>
  tidyr::pivot_wider(names_from = c(weighting, method),
              values_from = overall) |>
  dplyr::select(season, tidyr::starts_with("auc_pred"), tidyr::starts_with("auc_linear"), tidyr::starts_with("auc_anti")) |>
  flextable::flextable() |>
    flextable::add_header_row(top = TRUE,
                 values = c(" ", "Unweighted", "Linear", "AU"),
                 colwidths = c(1, rep(3, 3))) |>
  flextable::align(align = "center", part = "all") |>
  flextable::set_header_labels(values = list(
                                 season = "Season",
                                 auc_pred_Year = "Year",
                                 `auc_pred_P-epitope` = "P-epitope",
                                 auc_pred_Cartography = "Cartography",
                                 auc_linear_Year = "Year",
                                 `auc_linear_P-epitope` = "P-epitope",
                                 auc_linear_Cartography = "Cartography",
                                 auc_anti_Year = "Year",
                                 `auc_anti_P-epitope` = "P-epitope",
                                 auc_anti_Cartography = "Cartography"
                                 ))
```

```{r auc-vaccine, tab.cap = "Vaccine-based area under the curves for 2017 season.", tab.id = 'auc-vaccine', label = 'auc-vaccine'}
readRDS(file = here::here("results", "tables", "auc_sd_vaccine.rds")) |>
  dplyr::mutate(vac_short = factor(vac_short, labels = substr(levels(vac_short), #Remove the H1N1/H3N2 in front
                                                              start = 6,
                                                              stop = nchar(levels(vac_short)))),
                season = as.character(season)) |>
  tidyr::pivot_wider(names_from = strain_type,
              values_from =  c(vac_short, starts_with("auc"))) |>
  dplyr::rowwise() |>
  dplyr::mutate(auc_pred_over = auc_pred_H1N1 + auc_pred_H3N2,
                auc_linear_over = auc_linear_H1N1 + auc_linear_H3N2,
                auc_anti_over = auc_anti_H1N1 + auc_anti_H3N2) |>
  dplyr::select(season, starts_with("vac"), method, starts_with("auc_pred"), starts_with("auc_linear"), starts_with("auc_anti")) |>
  flextable::flextable() |>
  align(align = "center", part = "all") |>
  set_header_labels(values = list(
                                 method = "Method",
                                 season = "Season",
                                 vac_short_H1N1 = "H1N1",
                                 vac_short_H3N2 = "H3N2",
                                 auc_pred_H1N1 = "H1N1",
                                 auc_pred_H3N2 = "H3N2",
                                 auc_pred_over = "Overall",
                                 auc_linear_H1N1 = "H1N1",
                                 auc_linear_H3N2 = "H3N2",
                                 auc_linear_over = "Overall",
                                 auc_anti_H1N1 = "H1N1",
                                 auc_anti_H3N2 = "H3N2",
                                 auc_anti_over = "Overall")) |>
  flextable::autofit() |>
  flextable::merge_v(j = 1) |>
  flextable::merge_at(i = 1:3, j = 2) |>
  flextable::merge_at(i = 4:6, j = 2) |>
  flextable::merge_at(i = 7:9, j = 2) |>
  flextable::merge_at(i = 10:12, j = 2) |>
  flextable::merge_at(i = 13:15, j = 2) |>
  flextable::merge_at(i = 16:18, j = 2) |>
  flextable::merge_at(i = 1:3, j = 3) |>
  flextable::merge_at(i = 4:6, j = 3) |>
  flextable::merge_at(i = 7:9, j = 3) |>
  flextable::merge_at(i = 10:12, j = 3) |>
  flextable::merge_at(i = 13:15, j = 3) |>
  flextable::merge_at(i = 16:18, j = 3) |>
  flextable::hline(i = seq(3, 15, by = 3)) |>
  flextable::vline(j = c(4, 7, 10)) |>
  flextable::align(align = "center", part = "all") |>
  flextable::autofit() |>
  flextable::add_header_row(top = TRUE,
                 values = c(" ", "Vaccine Component", " ", "Unweighted", "Linear", "2 Antigenic Units"),
                 colwidths = c(1, 2, 1, rep(3, 3)))
  


```

## HD VS SD Analysis

```{r titinc-ind-hdsd, fig.cap ="The individal titer increase if the virus was a categorical variable for standard and high dose subset.", eval = FALSE}

knitr::include_graphics(here::here("results", "figures", "sdhd_strain_individual.png"))
```


```{r wo-distance-sdhd}

 readRDS(file = here::here("data/processed/averaged_SDHD_pro.rds")) |>
   select(c(strain_type, vac_short, dose, mean_tit, ind_n, total_strain, total_test, response, no_response, pro)) |>
  group_by(strain_type, vac_short) |>
  mutate(rel_risk_hd_sd = round(pro[2]/pro[1], digits= 3)) |>
  ungroup() |>
   flextable::flextable() |>
   set_header_labels(values = list(strain_type = "Subtype",
                                  vac_short = "Strain",
                                  dose= "Dose",
                                 mean_tit = "Mean log2 TI",
                                 ind_n = "Individuals",
                                 total_strain = "Viruses in HAI Panel",
                                 response = ">= 2 log2 TI",
                                 no_response = "< 2 log2 TI",
                                 total_test = "Experiments Conducted",
                                 pro = "Proportion w/Positive Response",
                                 rel_risk_hd_sd = "Relative Risk Ratio (HD:SD)")) |>
    merge_v(j = c("strain_type", "rel_risk_hd_sd")) |>
      flextable::hline(seq(2, 16, by = 2)) |>
  flextable::vline(j = c(3, 4, 7, 9)) |>
      add_header_row(top = TRUE,
                 values = c(" ","Sample Size (n=)", "HAI TI Outcome", " "),
                 colwidths = c(4, 3, 2, 2))

```


The HD and SD vaccine responses were compared to each other using the three different distance measures for both season- and vaccine-level normalizations (Figure \@ref(fig:HDSDinc-season) and \@ref(fig:HDSDinc-vaccine)). The 2017 season results are depicted in the main manuscript. The areas under the regression for each of the seasons are quantified in Tables \@ref(tab:auc-sdhd-season) and \@ref(tab:auc-sdhd-strain) respectively. 

```{r titinc-sdhd-strain, fig.cap= "The titer increase to the H1N1 and H3N2 virus panels for the 2017 season of all individuals greater than or equal to 65 years of age. The columns are separated by distance method. The linear regression of the titer increase with 95% standard error bands are shown for the dose received. The measures were normalized by the maximum value by method, season, and vaccine strain. The black line indicates no titer increase. The raw datapoints had jitter applied with +/- 0.4 in the y-axis. Raw data points that fell outside of the y-axis bounds are not shown. TI: Titer increase.", eval = FALSE}
knitr::include_graphics(here::here("results", "figures", "typeA_sdhd_titerincrease_strain.png"))

```

```{r HDSDinc-season, fig.cap="The titer increase to the H1N1 and H3N2 virus panels for the remaining seasons of all individuals greater than or equal to 65 years of age. The columns are separated by distance method. The linear regression of the titer increase with 95% confidence intervals are shown for the dose received. The measures were normalized by the maximum value by method, season, and vaccine strain. The black line indicates no titer increase. The raw datapoints had jitter applied with +/- 0.4 in the y-axis. Raw data points that fell outside of the y-axis bounds are not shown. TI: Titer increase.", eval = FALSE}
knitr::include_graphics(here::here("results", "figures", "typeA_sdhd_titerincrease_season.png"))
```


```{r HDSDinc-vaccine, fig.cap="The titer increase to the H1N1 and H3N2 virus panels for the remaining seasons of all individuals greater than or equal to 65 years of age. The columns are separated by distance method. The linear regression of the titer increase with 95% confidence intervals are shown for the dose received. The measures were normalized by the maximum value by method, season, and vaccine strain. The black line indicates no titer increase. The raw datapoints had jitter applied with +/- 0.4 in the y-axis. Raw data points that fell outside of the y-axis bounds are not shown. TI: Titer increase.", eval = FALSE}
knitr::include_graphics(here::here("results", "figures", "typeA_sdhd_titerincrease_vaccine.png"))
```


```{r auc-sdhd-season, tab.cap = "Area under the linear regression for three weighting schemes comparing HD and SD vaccinations", tab.id='auc-sdhd-season', label='auc-sdhd-season'}

readRDS(file = here::here("results", "tables", "auc_sdhd_season.rds")) |>
  pivot_wider(names_from = dose,
              values_from = auc_pred:auc_linear) |>
  rowwise() |>
  mutate(season = as.character(season),
         auc_pred_change = auc_pred_HD - auc_pred_SD,
         auc_linear_change = auc_linear_HD - auc_linear_SD,
         auc_anti_change = auc_anti_HD - auc_anti_SD) |>
  select(season, vac_short, method, starts_with("auc_pred"), starts_with("auc_linear"), starts_with("auc_anti")) |>
flextable() |>
  set_header_labels(values = list(season = "Season",
                                  vac_short = "Vaccine",
                                 method = "Method",
                                 auc_pred_HD = "HD",
                                 auc_pred_SD = "SD",
                                 auc_pred_change = "HD-SD",
                                 auc_linear_HD = "HD",
                                 auc_linear_SD = "SD",
                                 auc_linear_change = "HD-SD",
                                 auc_anti_HD = "HD",
                                 auc_anti_SD = "SD",
                                 auc_anti_change = "HD-SD")) |>
    merge_v(j = c("season", "vac_short")) |>
      hline(i = seq(3, 36, by =3)) |>
      add_header_row(top = TRUE,
                 values = c(" ","Unweighted", "Linear", "2 Antigenic Units"),
                 colwidths = c(3, rep(3, 3))) |>
  vline(j = c(6, 9))
```



```{r titinc-sdhd-vaccine, fig.cap= "The titer increase to the H1N1 and H3N2 virus panels for the 2017 season of all individuals greater than or equal to 65 years of age. The columns are separated by distance method. The linear regression of the titer increase with 95% standard error bands are shown for the dose received. The measures were normalized by the maximum value by method, season, and vaccine strain. The black line indicates no titer increase. The raw datapoints had jitter applied with +/- 0.4 in the y-axis. Raw data points that fell outside of the y-axis bounds are not shown. Other seasons are available in the SI. TI = Titer increase", eval = FALSE}
knitr::include_graphics(here::here("results", "figures", "typeA_sdhd_inc_season17_vaccine.png"))
```


```{r auc-sdhd-vaccine, tab.cap= "AUC for three weighting schemes for 65+ individuals by vaccine", label="auc-sdhd-vaccine", tab.id='auc-sdhd-vaccine'}
readRDS(file = here::here("results", "tables", "auc_sdhd_vaccine.rds")) |>
  dplyr::group_by(season, method, dose) |>
  dplyr::summarize(auc_pred = sum(auc_pred), 
            auc_anti = sum(auc_anti),
            auc_linear = sum(auc_linear)) |>
    pivot_wider(names_from = dose,
              values_from = auc_pred:auc_linear) |>
  rowwise() |>
  mutate(season = as.character(season),
         auc_pred_change = auc_pred_HD - auc_pred_SD,
         auc_linear_change = auc_linear_HD - auc_linear_SD,
         auc_anti_change = auc_anti_HD - auc_anti_SD) |>
  select(season, method, starts_with("auc_pred"), starts_with("auc_linear"), starts_with("auc_anti")) |>
    flextable() |>
  set_header_labels(values = list(season = "Season",
                                 method = "Method",
                                 auc_pred_HD = "HD",
                                 auc_pred_SD = "SD",
                                 auc_pred_change = "HD-SD",
                                 auc_linear_HD = "HD",
                                 auc_linear_SD = "SD",
                                 auc_linear_change = "HD-SD",
                                 auc_anti_HD = "HD",
                                 auc_anti_SD = "SD",
                                 auc_anti_change = "HD-SD")) |>
    merge_v(j = "season") |>
      add_header_row(top = TRUE,
                 values = c(" ","Unweighted", "Linear", "2 Antigenic Units"),
                 colwidths = c(2, rep(3, 3)))  |>
  hline(i = seq(3, 12, by = 3)) |>
  vline(j = c(2, 5, 8))
```

# Subset Analysis

The full dataset was separated into smaller subsets. The HAI viruses included in the subset included all of the vaccine strains for the subtype, and then ten randomly chosen breadth panel viruses (Table \@ref(tab:subset-viruses))

```{r subset-viruses, tab.cap = "HAI panel viruses randomly selected for each subsetted dataset.", tab.id='subset-viruses', label='subset-viruses', eval = FALSE}
vaccine_viruses <- readRDS(here::here("data/processed/vaccine_viruses.rds"))
readRDS(here::here("results", "tables", "data_subsets_viruses.rds"))  |>
  dplyr::mutate(virus_type = ifelse(analysis_name %in% vaccine_viruses, 
                                    "Vaccine",
                                    "Breadth"),
                strain_type = factor(strain_type, levels = c("H1N1", "H3N2", "B-Pre", "B-Vic", "B-Yam")),
                across(subset_1:subset_5, ~ifelse(virus_type == "Vaccine",
                                                            "x",
                                                            .))) |>
  dplyr::filter(strain_type %in% c("H1N1", "H3N2")) |>
  dplyr::arrange(strain_type, virus_type, factor_order) |>
  dplyr::select(strain_type, virus_type, analysis_name, contain, starts_with("subset")) |>
  flextable::flextable() |>
  flextable::set_header_labels(values = list(virus_type = "Category",
                                             strain_type = "Subtype",
                                 analysis_name = "Strain",
                                 contain = "Full",
                                 subset_1 = "1",
                                 subset_2 = "2",
                                 subset_3 = "3",
                                 subset_4 = "4",
                                 subset_5 = "5")) |>
    flextable::add_header_row(top = TRUE,
                 values = c(" ", "Data Subset"),
                 colwidths = c(3, 6)) |>
  flextable::align_text_col(align = "center") |>
  flextable::align(align = "center") |>
    flextable::hline(i = c(15, 18, 34, 39)) |>
  flextable::merge_v(j = 1:2) |>
    flextable::autofit()
```

## SD Analysis

Of the SD recipients the strain-level (Figure \@ref(fig:strain-subset)), and the season-level (Figure \@ref(fig:season-subset)) were visualized. 

```{r strain-subset, fig.cap = "Subset analysis of SD individuals' titier increase across the 2014 to 2019 seasons. The columns are separated by distance method. The linear regression of the titer increase with 95% standard error bands are shown for the dose received. If the standard error bands are not visible they are smaller than the width of the line. The measures were normalized by the maximum value by method and vaccine strain within each of the subsets. The black line indicates no titer increase. The raw datapoints had jitter applied with +/- 0.4 in the y-axis. Raw data points that fell outside of the y-axis bounds are not shown.", eval = FALSE}
knitr::include_graphics(here::here("figures/subset_analysis/sd_inc_strain.png"))
```

```{r season-subset, fig.cap = "Subset analysis of SD individuals across the 2014 to 2019 seasons. The columns are separated by distance method. The linear regression of the titer increase with 95% standard error bands are shown for the dose received. If the standard error bands are not visible they are smaller than the width of the line. The measures were normalized by the maximum value by method and vaccine strain within each of the subsets. The black line indicates no titer increase. The raw datapoints had jitter applied with +/- 0.4 in the y-axis. Raw data points that fell outside of the y-axis bounds are not shown. n: number of individuals", eval = FALSE}
knitr::include_graphics(here::here("figures/subset_analysis/sd_inc_season.png"))
```

## Comparison of HD and SD Dose

In the subset analysis, the strain-level differences of the SD and HD vaccines were investigated for H1N1 (Figure \@ref(fig:h1n1-subset-strain-hdsd)) and H3N2 subtypes (Figure \@ref(fig:h3n2-subset-strain-hdsd)).

```{r h1n1-subset-strain-hdsd, fig.cap = "Subset analysis of the individuals who recieved an H1N1 component across the 2014 to 2019 seasons. All individuals greater than or equal to 65 years of age were included and are stratified by whether they recieved SD or HD vaccination. The columns are separated by distance method. The linear regression of the titer increase with 95% standard error bands are shown for the dose received. If the standard error bands are not visible they are smaller than the width of the line. The measures were normalized by the maximum value by method and vaccine strain within each of the subsets. The black line indicates no titer increase. The raw datapoints had jitter applied with +/- 0.4 in the y-axis. Raw data points that fell outside of the y-axis bounds are not shown. n: number of individuals", eval = FALSE}
knitr::include_graphics(here::here("figures/subset_analysis/H1N1_sdhd_inc_strain.png"))
```


```{r h3n2-subset-strain-hdsd, fig.cap = "Subset analysis of the individuals who recieved an H3N2 component across the 2014 to 2019 seasons. All individuals greater than or equal to 65 years of age were included and are stratified by whether they recieved SD or HD vaccination. The columns are separated by distance method. The linear regression of the titer increase with 95% standard error bands are shown for the dose received. If the standard error bands are not visible they are smaller than the width of the line. The measures were normalized by the maximum value by method and vaccine strain within each of the subsets. The black line indicates no titer increase. The raw datapoints had jitter applied with +/- 0.4 in the y-axis. Raw data points that fell outside of the y-axis bounds are not shown. n: number of individuals", eval = FALSE}
knitr::include_graphics(here::here("figures/subset_analysis/H3N2_sdhd_inc_strain.png"))
```

\newpage
# Bibliography
